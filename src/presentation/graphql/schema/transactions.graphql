extend type Query {
  """
  Get transactions with optional filters and pagination.
  Returns paginated results with total count.
  """
  transactions(filter: TransactionFilter, pagination: PaginationInput): TransactionConnection!

  """
  Get a single transaction by its database ID.
  """
  transaction(id: Int!): Transaction
}

extend type Mutation {
  """
  Create a transaction on a manual (non-synced) account.
  Synced accounts can only receive transactions via bank sync.
  """
  createTransaction(input: CreateTransactionInput!): Transaction!

  """
  Update the category of a transaction.
  """
  updateTransactionCategory(input: UpdateTransactionCategoryInput!): Transaction!

  """
  Update the budget of a transaction.
  """
  updateTransactionBudget(input: UpdateTransactionBudgetInput!): Transaction!

  """
  Mark a transaction as verified (user confirmed categorization).
  """
  verifyTransaction(id: Int!): Transaction!
}

input TransactionFilter {
  """
  Filter by account database ID.
  """
  accountId: Int

  """
  Filter by category database ID.
  """
  categoryId: Int

  """
  Filter by budget database ID.
  """
  budgetId: Int

  """
  If true, filter for transactions with no budget assigned (budgetId IS NULL).
  Takes precedence over budgetId filter.
  """
  unbudgetedOnly: Boolean

  """
  Filter by account role (operational or savings).
  """
  accountRole: AccountRole

  """
  Filter by transaction type (CREDIT or DEBIT).
  """
  type: TransactionTypeEnum

  """
  Filter by categorization status.
  """
  categorizationStatus: CategorizationStatusEnum

  """
  Start date for date range filter (ISO date string, inclusive).
  """
  dateFrom: String

  """
  End date for date range filter (ISO date string, inclusive).
  """
  dateTo: String

  """
  Search text (matches description or counterparty).
  """
  search: String
}

input PaginationInput {
  """
  Number of items per page. Defaults to 50.
  """
  limit: Int

  """
  Offset for pagination. Defaults to 0.
  """
  offset: Int
}

input UpdateTransactionCategoryInput {
  """
  Transaction database ID.
  """
  id: Int!

  """
  Category database ID. Pass null to remove category.
  """
  categoryId: Int
}

input UpdateTransactionBudgetInput {
  """
  Transaction database ID.
  """
  id: Int!

  """
  Budget database ID. Pass null to remove budget.
  """
  budgetId: Int
}

input CreateTransactionInput {
  """
  Account database ID. Must be a manual (non-synced) account.
  """
  accountId: Int!

  """
  Transaction date as ISO date string (e.g., "2024-01-15").
  """
  date: String!

  """
  Amount in major units (e.g., 100.50). Always positive.
  """
  amount: Float!

  """
  Transaction type: CREDIT for income, DEBIT for expense.
  """
  type: TransactionTypeEnum!

  """
  Description of the transaction.
  """
  description: String!

  """
  Optional counterparty name.
  """
  counterpartyName: String

  """
  Optional counterparty IBAN.
  """
  counterpartyIban: String

  """
  Optional MCC (Merchant Category Code).
  """
  mcc: Int

  """
  Optional notes about the transaction.
  """
  notes: String
}

type TransactionConnection {
  items: [Transaction!]!
  totalCount: Int!
  hasMore: Boolean!
}

type Transaction {
  id: Int!
  externalId: String!
  date: String!
  """
  Amount in major units (always positive).
  """
  amount: Float!
  currency: String!
  type: TransactionTypeEnum!
  description: String!
  categorizationStatus: CategorizationStatusEnum!
  categoryReason: String
  budgetReason: String
  mcc: Int
  counterpartyName: String
  counterpartyIban: String
  hold: Boolean!
  """
  Cashback in major units.
  """
  cashbackAmount: Float
  """
  Commission in major units.
  """
  commissionAmount: Float
  receiptId: String
  notes: String

  """
  Account this transaction belongs to.
  """
  account: Account

  """
  Assigned category (null if uncategorized).
  """
  category: Category

  """
  Assigned budget (null if unbudgeted).
  """
  budget: Budget

  """
  If true, this transaction is excluded from balance and budget calculations.
  Used for transfers between own accounts, corrections, etc.
  """
  excludeFromCalculations: Boolean!
}

enum TransactionTypeEnum {
  CREDIT
  DEBIT
}

enum CategorizationStatusEnum {
  PENDING
  CATEGORIZED
  VERIFIED
}
